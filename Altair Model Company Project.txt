select*from products;
select*from orderdetails;
select*from customers;
select*from payments;
select*from employees;
select*from offices;


General Select code

SELECT DISTINCT column_name, AGG_FUNC(column_or_expression), â€¦
FROM mytable
    JOIN another_table
      ON mytable.column = another_table.column
    WHERE constraint_expression
    GROUP BY column
    HAVING constraint_expression
    ORDER BY column ASC/DESC
    LIMIT count OFFSET COUNT;



// starts here //
/* i think we are missing subquery's throught the project. we gotta learn that*/

/*Sales topic:*/

SELECT year(o.orderdate), Month(o.orderdate), p.productLine, sum(od.quantityOrdered) as total_ordered
FROM orderdetails od 
    JOIN products p  
      ON od.productcode = p.productcode 
	JOIN orders o
      ON od.ordernumber = o.ordernumber
    GROUP BY year(o.orderdate), Month(o.orderdate), p.productLine 
    ORDER BY year(o.orderdate) asc, month(o.orderdate) asc, sum(od.quantityOrdered) DESC;
    
    
    not finished
    
    SELECT year(orderdate), Month(o.orderdate), p.productLine, sum(od.quantityOrdered),
LAG(sum(od.quantityOrdered)) over (order by year(orderdate), month(orderdate))
FROM orderdetails od 
    left JOIN products p  
      ON od.productcode = p.productcode 
	left JOIN orders o
      ON od.ordernumber = o.ordernumber
    GROUP BY year(o.orderdate), Month(o.orderdate), p.productLine
    ORDER BY year(o.orderdate) asc, month(o.orderdate) asc;
    
    
/*--this is another part of code which gives categories as columns
  
SELECT 
YEAR(o.orderDate) as Sales_Year,
MONTH(o.orderDate) as Sales_Month,
SUM(case when p.productLine = 'Motorcycles' then od.quantityOrdered else 0 end) AS Motorcycles_Sales,
SUM(case when p.productLine = 'Classic Cars' then od.quantityOrdered else 0 end) AS Classic_Cars_Sales,
SUM(case when p.productLine = 'Trucks and Buses' then od.quantityOrdered else 0 end) AS Trucks_Buses_Sales,
SUM(case when p.productLine = 'Vintage Cars' then od.quantityOrdered else 0 end) AS Vintage_Cars_Sales,
SUM(case when p.productLine = 'Planes' then od.quantityOrdered else 0 end) AS Planes_Sales,
SUM(case when p.productLine = 'Trains' then od.quantityOrdered else 0 end) AS Trains_Sales,
SUM(case when p.productLine = 'Ships' then od.quantityOrdered else 0 end) AS Ships_Sales
FROM orders o
join orderdetails od on o.orderNumber = od.orderNumber
join products p on p.productCode = od.productCode
WHERE YEAR(o.orderDate)='2021'
GROUP BY YEAR(o.orderDate), MONTH(o.orderDate)
ORDER BY YEAR(o.orderDate), MONTH(o.orderDate);
    
    
/*Financial Topic

Q1 -monthly turnover by country*/


SELECT sum(od.quantityordered) as order_turnover, c.country as customer_country
FROM customers c
	left Join orders o
		ON c.customerNumber = o.customernumber
	jOIN orderdetails od
		ON od.ordernumber = o.ordernumber
	GROUP BY c.country
	ORDER BY c.country, sum(od.quantityOrdered) DESC;
    
    /*missing the rest of the question*/
    
    
   Q2- Orders not paid
   
   	/* orders not paid and theyr value */
   	Select o.customernumber, o.orderdate, o.ordernumber, sum((od.quantityordered * od.priceeach)) as Order_Value
from orders o
join orderdetails od
	on o.ordernumber = od.ordernumber
group by o.ordernumber
having sum((od.quantityordered * od.priceeach)) not in (select p.amount
from payments p)/* this subquery will compare if there are values in the oder_value column in order table that are not in the ammount column in payments table and, therefore, are not being paid*/;

/*Logistics topic*/

SELECT p.productName, sum(od.quantityOrdered) as Total_ordered
FROM orderdetails od
    JOIN products p
      ON od.productcode = p.productcode
    GROUP BY p.productCode
    ORDER BY sum(od.quantityOrdered) DESC
    LIMIT 5;
    
    
/* top 5 ordered products, missing the rest */

/* human resources topic */


SELECT year, month, x.sellers, monthly_turnover
FROM (SELECT year(o.OrderDate) as year,
			month(o.OrderDate) as month,
			concat(e.firstName, ' ', e.lastname) AS sellers,
            SUM(od.quantityOrdered) AS monthly_turnover,
            row_number() over (partition by year(o.OrderDate), month(o.OrderDate) order by SUM(od.quantityOrdered) desc) as seq
FROM orders as o
JOIN customers as c
ON c.customerNumber=o.customerNumber
JOIN employees as e
ON e.employeeNumber=c.salesRepEmployeeNumber
JOIN orderdetails as od
ON od.orderNumber=o.orderNumber
GROUP BY year(o.OrderDate), month(o.OrderDate), sellers
Order by year(o.OrderDate), month(o.OrderDate)) as x
where x.seq <=2;
